# 三班別護病比設定功能 - 實現總結

## ✅ 已完成的功能

### 1. 資料庫更新
- 新增三個欄位到 Ward 表：
  - `minNursesDay` (預設7人) - 日班最低護理師數
  - `minNursesEvening` (預設7人) - 小夜班最低護理師數  
  - `minNursesNight` (預設4人) - 大夜班最低護理師數
- 成功執行遷移：`20260201122334_add_shift_specific_nurse_requirements`

### 2. 設定頁面更新 (`/settings`)
- **新增「各班別護理師需求設定」卡片**
- **兩種設定模式**：
  - 「依護病比自動計算」：根據病床數和護病比自動算出各班人數
  - 「手動設定各班人數」：直接輸入日班、小夜班、大夜班的需求人數
- **實時預覽**：顯示系統將如何依據設定進行自動排班
- **各班獨立設定**：
  - 日班 (07:00-15:00): 可設定 1-50人
  - 小夜班 (15:00-23:00): 可設定 1-50人
  - 大夜班 (23:00-07:00): 可設定 1-50人

### 3. API 更新
- **GET /api/ward/settings**: 返回各班別最低人數設定
- **POST /api/ward/settings**: 接受並儲存各班別設定
- **驗證邏輯**: 確保各班人數在有效範圍內 (1-50)

## 🎯 使用範例

### 範例 1：使用護病比自動計算
```
病床數：50床
護病比：1:8
日班需求 = ceil(50/8) = 7人
小夜班需求 = ceil(50/8) = 7人  
大夜班需求 = max(2, ceil(50/8*0.6)) = 4人
```

### 範例 2：手動設定（如使用者要求）
```
日班：8人
小夜班：10人
大夜班：6人
```
系統將依據此設定進行自動排班。

## 🚀 下一步建議

為了讓系統真正使用這些設定進行自動排班，需要更新：

1. **假期優先模式 API** (`/api/schedules/leave-priority`)
   - 修改排班邏輯，使用 `minNursesDay/Evening/Night` 而非統一的 `requiredNursesPerShift`
   - 確保每班達到各自的最低人數要求

2. **三班模式 API** (`/api/schedules/three-shift-v2`)
   - 更新排班邏輯，考慮各班別的特定需求

3. **手動排班頁面** (`/app/schedule/page.tsx`)
   - 更新護病比檢查函數 `getShiftCoverageStatus`，使用各班別的最低需求
   - 日曆格子顯示各班實際需求（而非統一計算）

這些更新將確保系統完全按照使用者在設定頁面配置的各班別需求進行排班。

## 📊 驗證檢查清單

- [ ] 訪問 `/settings` 頁面
- [ ] 確認看到「各班別護理師需求設定」區塊
- [ ] 測試「依護病比自動計算」模式，修改護病比觀察自動更新
- [ ] 切換到「手動設定各班人數」模式
- [ ] 設定日班8人、小夜班10人、大夜班6人
- [ ] 儲存設定
- [ ] 確認儲存成功訊息
